<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:SubsTracker.ViewModels"
             x:Class="SubsTracker.Views.AddSubscriptionPage"
             Title="New Subscription"
             Shell.NavBarIsVisible="False"
             BackgroundColor="{AppThemeBinding Light=#F0F0F0, Dark=#1E1E1E}">

    <Grid RowDefinitions="60, *">

        <Grid Grid.Row="0" Padding="15,0">
            <ImageButton Source="back.png"
                         Command="{Binding CancelCommand}"
                         HeightRequest="40" WidthRequest="40"
                         Padding="6"
                         HorizontalOptions="Start" VerticalOptions="Center"
                         BackgroundColor="Transparent"/>

            <Label Text="Add New Subscription"
                   FontSize="18" FontAttributes="Bold"
                   HorizontalOptions="Center" VerticalOptions="Center"
                   InputTransparent="True"
                   TextColor="{AppThemeBinding Light=Black, Dark=White}"/>
        </Grid>

        <ScrollView Grid.Row="1" Padding="0,0,0,20">

            <VerticalStackLayout VerticalOptions="Center" Spacing="20">

                <Frame BackgroundColor="{AppThemeBinding Light=White, Dark=#1E1E1E}"
                       CornerRadius="20"
                       Padding="20"
                       Margin="15,0,15,0"
                       HasShadow="True"
                       BorderColor="Transparent">

                    <VerticalStackLayout Spacing="15">
                        <VerticalStackLayout Spacing="5">
                            <Label Text="Name" TextColor="Gray" FontSize="12" Margin="5,0"/>
                            <Border StrokeShape="RoundRectangle 10" StrokeThickness="0" BackgroundColor="#F3F4F6" Padding="15,2" HeightRequest="50">
                                <Entry Text="{Binding Name}" Placeholder="Netflix" VerticalOptions="Center"/>
                            </Border>
                        </VerticalStackLayout>

                        <VerticalStackLayout Spacing="5">
                            <Label Text="Description" TextColor="Gray" FontSize="12" Margin="5,0"/>
                            <Border StrokeShape="RoundRectangle 10" StrokeThickness="0" BackgroundColor="#F3F4F6" Padding="15,2" HeightRequest="50">
                                <Entry Text="{Binding Description}" Placeholder="Family Plan" VerticalOptions="Center"/>
                            </Border>
                        </VerticalStackLayout>

                        <VerticalStackLayout Spacing="5">
                            <Label Text="Price" TextColor="Gray" FontSize="12" Margin="5,0"/>
                            <Border StrokeShape="RoundRectangle 10" StrokeThickness="0" BackgroundColor="#F3F4F6" Padding="15,2" HeightRequest="50">
                                <Grid ColumnDefinitions="Auto, *">
                                    <Label Text="$" TextColor="Gray" VerticalOptions="Center" FontSize="18" Margin="0,0,5,0"/>
                                    <Entry Grid.Column="1" Text="{Binding Price}" Keyboard="Numeric" Placeholder="0.00" VerticalOptions="Center"/>
                                </Grid>
                            </Border>
                        </VerticalStackLayout>

                        <Grid ColumnDefinitions="*, *" ColumnSpacing="15">
                            <VerticalStackLayout Spacing="5">
                                <Label Text="Interval" TextColor="Gray" FontSize="12" Margin="5,0"/>
                                <Border StrokeShape="RoundRectangle 10" StrokeThickness="0" BackgroundColor="#F3F4F6" Padding="0" HeightRequest="50">
                                    <Entry Text="{Binding BillingInterval}" Keyboard="Numeric" HorizontalTextAlignment="Center" VerticalOptions="Center"/>
                                </Border>
                            </VerticalStackLayout>

                            <VerticalStackLayout Grid.Column="1" Spacing="5">
                                <Label Text="Unit" TextColor="Gray" FontSize="12" Margin="5,0"/>
                                <Border StrokeShape="RoundRectangle 10" StrokeThickness="0" BackgroundColor="#F3F4F6" Padding="0" HeightRequest="50">
                                    <Picker ItemsSource="{Binding PeriodUnits}" SelectedItem="{Binding SelectedPeriodUnit}" HorizontalTextAlignment="Center" VerticalTextAlignment="Center"/>
                                </Border>
                            </VerticalStackLayout>
                        </Grid>

                        <VerticalStackLayout Spacing="5">
                            <Label Text="Category" TextColor="Gray" FontSize="12" Margin="5,0"/>
                            <Border StrokeShape="RoundRectangle 10" StrokeThickness="0" BackgroundColor="#F3F4F6" Padding="5,2" HeightRequest="50">
                                <Picker ItemsSource="{Binding CommonCategories}" SelectedItem="{Binding SelectedCategory}" VerticalTextAlignment="Center"/>
                            </Border>

                            <Border StrokeShape="RoundRectangle 10" StrokeThickness="0" BackgroundColor="#F3F4F6" Padding="15,2" HeightRequest="50" Margin="0,5,0,0">
                                <Border.Triggers>
                                    <DataTrigger TargetType="Border" Binding="{Binding SelectedCategory}" Value="Other">
                                        <Setter Property="IsVisible" Value="True"/>
                                    </DataTrigger>
                                    <DataTrigger TargetType="Border" Binding="{Binding SelectedCategory}" Value="Streaming">
                                        <Setter Property="IsVisible" Value="False"/>
                                    </DataTrigger>
                                </Border.Triggers>
                                <Entry Text="{Binding CustomCategory}" Placeholder="Type custom category..." VerticalOptions="Center"/>
                            </Border>
                        </VerticalStackLayout>

                        <VerticalStackLayout Spacing="5">
                            <Label Text="Next Payment" TextColor="Gray" FontSize="12" Margin="5,0"/>
                            <Border StrokeShape="RoundRectangle 10" StrokeThickness="0" BackgroundColor="#F3F4F6" Padding="15,2" HeightRequest="50">
                                <DatePicker Date="{Binding NextPaymentDate}" VerticalOptions="Center"/>
                            </Border>
                        </VerticalStackLayout>
                        <Grid ColumnDefinitions="*,*" ColumnSpacing="15" Padding="0,15,0,0">
                            <Button Grid.Column="0" 
                                    CornerRadius="12"
                                Text="Cancel"
                                Command="{Binding CancelCommand}"
                                BackgroundColor="#E0E0E0"
                                TextColor="Black" />

                            <Button Grid.Column="1"
                                    CornerRadius="12"
                                Text="Save"
                                Command="{Binding SaveCommand}"
                                BackgroundColor="{StaticResource Primary}"
                                TextColor="White" />
                         </Grid>
                    </VerticalStackLayout>
                </Frame>

                

            </VerticalStackLayout>
        </ScrollView>
    </Grid>
</ContentPage>